---
// src/components/Stats.astro
---
<section class="py-20 sm:py-32 bg-white">
  <div class="container px-4 md:px-8 grid md:grid-cols-5 gap-8 items-center">

    
    <!-- Text Content -->
    <div class="md:col-span-3">
      <h2 class="font-heading text-4xl md:text-5xl uppercase text-gray-800 mb-4 tracking-wide">
        Jumlah SKU
      </h2>
      <p class="text-lg text-gray-600 max-w-2xl">
        SonusHUB terus bertumbuh menambah jumlah SKU tersedia untuk menjadi <em>One Stop Platform</em> untuk kebutuhan kelistrikan, <em>smart manufacturing</em> dan energi terbarukan perusahaan Anda.
      </p>
    </div>

    <!-- Animated Counter -->
    <div class="md:col-span-2 text-center md:text-right">
      <div 
        id="sku-counter"
        class="font-heading text-7xl md:text-9xl font-bold text-[#014AAD]" 
        data-final-value="10421"
      >
        0
      </div>
      <div class="text-lg font-semibold text-gray-700 mt-2 tracking-wider">
        <strong>SKU TER-UPLOAD</strong>
      </div>
    </div>

  </div>
</section>

<script>
  const counterElement = document.getElementById('sku-counter');
  
  const animateCounter = (element: HTMLElement, finalValue: number) => {
    const duration = 2000; // 2 seconds
    const startValue = 0;
    const range = finalValue - startValue;
    let startTime: number | null = null;

    const step = (timestamp: number) => {
      if (!startTime) startTime = timestamp;
      const progress = Math.min((timestamp - startTime) / duration, 1);
      const currentValue = Math.floor(progress * range + startValue);
      
      // Format number with dots as thousand separators
      element.innerText = new Intl.NumberFormat('de-DE').format(currentValue);

      if (progress < 1) {
        window.requestAnimationFrame(step);
      } else {
        element.innerText = new Intl.NumberFormat('de-DE').format(finalValue);
      }
    };
    
    window.requestAnimationFrame(step);
  };

  if (counterElement) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const finalValueString = counterElement.getAttribute('data-final-value');
          if (finalValueString) {
            const finalValue = parseInt(finalValueString, 10);
            animateCounter(counterElement, finalValue);
            observer.unobserve(counterElement); // Stop observing after animation starts
          }
        }
      });
    }, {
      threshold: 0.5 // Trigger when 50% of the element is visible
    });

    observer.observe(counterElement);
  }
</script>